from io import BytesIO
from pdfdocument.document import PDFDocument
import requests
import json

ask = input("CVE to search for: ")
query = requests.get("http://cve.circl.lu/api/cve/{}".format(ask))
a = query.text
j = json.loads(a)

def capec(pdf):
	pdf.h2("CVE Details")
	msg = ''
	leng = (len(j["capec"]))
	for i in range(leng):
		msg = msg + "ID\t{}\nName\t{}\nPrerequisites\t{}\nSolution\n{}\nSummary\n{}\n".format(j['capec'][i]['id'],j['capec'][i]['name'],j['capec'][i]['prerequisites'],j['capec'][i]['solutions'],j['capec'][i]['summary'])

	pdf.p(msg)

def vuln(pdf):
	pdf.h2("Vulnerable Products")
	msg = ''
	vuleng = (len(j["vulnerable_product"]))
	for i in range(vuleng):
		msg = msg + (j["vulnerable_product"][i])
	pdf.p(msg)


intro =  ("Published Date\t{}\nAssigner\t{}\nSummary:\n{}".format(j["Published"],j["assigner"],j["summary"]))
#vuln()
#capec()



f = BytesIO()
pdf = PDFDocument("CVE Report.pdf")
pdf.init_report()
pdf.h1("CVE Report: cve-{}".format(ask))
pdf.p(intro)
vuln(pdf)
capec(pdf)

pdf.generate()
